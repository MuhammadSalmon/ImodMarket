{% extends 'shopapp/base.html' %}

{% block container %}
<div class="container mx-auto mt-10">


    <div class="container mx-auto mt-10">
        <h1 class="text-2xl font-bold mb-5 text-center">Продукты</h1>

        {% if not products %}
        <h2 class="text-center">Пока нет продуктов</h2>
        {% else %}
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {% for product in products %}
            <div class="bg-white shadow-lg rounded-lg p-6 transition transform hover:-translate-y-1 hover:shadow-2xl">
                <a href="{% url 'shopapp:product_detail' product.pk %}">
                    <div class="h-48 w-full mb-4 rounded overflow-hidden">
                        {% if product.image %}
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover">
                        {% else %}
                        <img src="https://via.placeholder.com/400" alt="{{ product.name }}"
                            class="w-full h-full object-cover">
                        {% endif %}
                    </div>
                </a>
                <h2 class="text-xl font-bold mb-2">{{ product.name }}</h2>

                <p class="text-gray-900 font-bold mb-4">${{ product.price }}</p>
                <form id="add-to-cart-form" method="post" action="{% url 'cart:add_to_cart' product.id %}">
                    {% csrf_token %}
                    <div class="mb-4">
                        <label for="quantity" class="block text-gray-700 text-sm font-bold mb-2">Quantity:</label>
                        <input type="number" id="quantity" name="quantity" min="1" value="1"
                            class="w-20 p-2 border border-gray-300 rounded">
                    </div>
                    <button type="submit" id="add-to-cart-btn"
                        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 focus:outline-none focus:shadow-outline">
                        Add to Cart
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>

</div>
<script>
    document.getElementById('add-to-cart-form').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent the default form submission

        var form = this;
        var formData = new FormData(form); // Get form data

        // Send an AJAX request
        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}' // Add CSRF token
            }
        })
            .then(response => {
                if (response.ok) {
                    // Cart updated successfully
                    alert('Продукт добавлена в корзину!');
                } else {
                    // Handle error
                    alert('Failed to add product to cart. Please try again later.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Что-то пошло не так.');
            });
    });
</script>
{% endblock container %}
<!-- 
<form method="get" action="{% url 'shopapp:product_list' %}" class="mb-6 flex justify-center">
    <div class="flex flex-col items-center">
        {{ form.query.label_tag }}
        <input type="text" name="query" value="{{ request.GET.query }}" placeholder="Search products..."
            class="shadow appearance-none border rounded-lg w-96 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        <button type="submit"
            class="bg-blue-500 text-white px-4 py-2 rounded-lg mt-4 hover:bg-blue-600 focus:outline-none focus:shadow-outline">
            Search
        </button>
    </div>
</form>  -->