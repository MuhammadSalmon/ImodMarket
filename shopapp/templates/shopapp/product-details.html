<!-- shopapp/templates/shopapp/product_detail.html -->
{% extends 'shopapp/base.html' %}

{% block title %}
<title>{{ product.name }}</title>
{% endblock title %}

{% block container %}
<div class="max-w-6xl mx-auto px-4 py-8">
    <div class="bg-white p-8 rounded-lg shadow-lg">
        <!-- Back to Home Link -->
        <div class="mb-4">
            <a href="{% url 'shopapp:product' %}" class="text-blue-500 hover:text-blue-700 font-semibold">
                &larr; Назад в продукты
            </a>
        </div>
        <div class="flex flex-col md:flex-row">
            <div class="md:w-1/2">
                {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-auto rounded">
                {% else %}
                <img src="https://via.placeholder.com/400" alt="{{ product.name }}" class="w-full h-auto rounded">
                {% endif %}
            </div>
            <div class="md:w-1/2 md:pl-8 mt-4 md:mt-0">
                <h1 class="text-3xl font-bold mb-4">{{ product.name }}</h1>
                <p class="text-gray-700 mb-4">{{ product.description }}</p>
                <p class="text-xl font-semibold text-blue-500 mb-4">${{ product.price }}</p>

                <!-- Add to Cart Form -->
                <form id="add-to-cart-form" method="post" action="{% url 'cart:add_to_cart' product.id %}">
                    {% csrf_token %}
                    <div class="mb-4">
                        <label for="quantity" class="block text-gray-700 text-sm font-bold mb-2">Quantity:</label>
                        <input type="number" id="quantity" name="quantity" min="1" value="1"
                            class="w-20 p-2 border border-gray-300 rounded">
                    </div>
                    <button type="submit" id="add-to-cart-btn"
                        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 focus:outline-none focus:shadow-outline">
                        Add to Cart
                    </button>
                </form>

                <script>
                    document.getElementById('add-to-cart-form').addEventListener('submit', function (event) {
                        event.preventDefault(); // Prevent the default form submission

                        var form = this;
                        var formData = new FormData(form); // Get form data

                        // Send an AJAX request
                        fetch(form.action, {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-CSRFToken': '{{ csrf_token }}' // Add CSRF token
                            }
                        })
                            .then(response => {
                                if (response.ok) {
                                    // Cart updated successfully
                                    alert('Product added to cart!');
                                } else {
                                    // Handle error
                                    alert('Failed to add product to cart. Please try again later.');
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('An error occurred. Please try again later.');
                            });
                    });
                </script>

            </div>
        </div>
    </div>
</div>
{% endblock container %}